{"body":[{"index":"au-orca-product"},{"from":0,"size":20,"sort":[{"_score":{"order":"desc"}}],"collapse":{"field":"groupId","inner_hits":{"name":"productGroup","size":500,"_source":["merchant","title","dataSource","orcaMerchantId","price","url","imageUrl","imgproxyHashS292","imgproxyHashS180","imgproxyHashOriginalSize","brandId","isPriceDown","isInStock","seller","sellerRating","officialSeller","powerSeller"],"script_fields":{"computedPrice":{"script":{"id":"au-iOS-rebate-script"}}}}},"stored_fields":["_source"],"query":{"function_score":{"query":{"bool":{"should":[{"terms":{"categoryLv2Id.keyword":[58,36,45]}}],"filter":[{"term":{"isAdult":"no"}}],"minimum_should_match":1}},"score_mode":"multiply","boost_mode":"multiply","functions":[{"field_value_factor":{"field":"staticScore","missing":1}},{"script_score":{"script":{"source":"((doc[\"categoryLv3Id\"].size() != 0 && doc[\"categoryLv3Id\"].value == 3013) ? 0.5 : 1) * ((doc[\"categoryLv3Id\"].size() != 0 && doc[\"categoryLv3Id\"].value == 472) ? 0.5 : 1) * ((doc[\"orcaMerchantId\"].size() != 0 && doc[\"orcaMerchantId\"].value == 19) && ((doc[\"categoryLv3Id\"].size() != 0 && doc[\"categoryLv3Id\"].value != 5009) || doc[\"categoryLv3Id\"].size() == 0) ? 1.2 : 1) ;"}}}]}},"aggs":{"total":{"cardinality":{"field":"groupId","precision_threshold":10000}}}},{"index":"au-orca-product"},{"size":0,"query":{"function_score":{"query":{"bool":{"should":[{"terms":{"categoryLv2Id.keyword":[58,36,45]}}],"filter":[{"term":{"isAdult":"no"}}],"minimum_should_match":1}},"score_mode":"multiply","boost_mode":"multiply","functions":[{"field_value_factor":{"field":"staticScore","missing":1}},{"script_score":{"script":{"source":"((doc[\"categoryLv3Id\"].size() != 0 && doc[\"categoryLv3Id\"].value == 3013) ? 0.5 : 1) * ((doc[\"categoryLv3Id\"].size() != 0 && doc[\"categoryLv3Id\"].value == 472) ? 0.5 : 1) * ((doc[\"orcaMerchantId\"].size() != 0 && doc[\"orcaMerchantId\"].value == 19) && ((doc[\"categoryLv3Id\"].size() != 0 && doc[\"categoryLv3Id\"].value != 5009) || doc[\"categoryLv3Id\"].size() == 0) ? 1.2 : 1) ;"}}}]}},"aggs":{"categories":{"terms":{"field":"categoryLv3Id","size":500}},"stores":{"terms":{"field":"orcaMerchantId","size":500}},"brands":{"terms":{"field":"brandId","size":500}}}}]}