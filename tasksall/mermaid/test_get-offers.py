import json
import base64
import sys
from locust import HttpUser, TaskSet, task, between
from random import randint
import base64  
class UserBehavior(TaskSet):
    testAccountIds = [600011111,600011132,600011143,600011121,600011133,600011144,600011122,600011134,600011145,600011123,600011135,600011146,600011124,600011136,600011147,600011125,600011137,600011148,600011126,600011138,600011114,600011149,600011127,600011139,600011116,600011128,600011140,600011117,600011129,600011141,600011118,600011131,600011142,600011119,600011112,600011292,600011324,600011356,600011164,600011196,600011228,600011260,600011303,600011335,600011175,600011207,600011239,600011271,600011314,600011346,600011186,600011218,600011250,600011282,600011293,600011325,600011357,600011197,600011229,600011261,600011304,600011336,600011176,600011208,600011240,600011272,600011347,600011187,600011219,600011251,600011283,600011294,600011326,600011358,600011166,600011198,600011230,600011262,600011305,600011337,600011177,600011209,600011241,600011273,600011316,600011348,600011188,600011220,600011252,600011284,600011295,600011327,600011359,600011167,600011199,600011231,600011263,600011306,600011338,600011178,600011210,600011242,600011274,600011317,600011349,600011189,600011221,600011253,600011285,600011296,600011328,600011360,600011168,600011200,600011232,600011264,600011307,600011339,600011179,600011211,600011243,600011275,600011318,600011350,600011190,600011222,600011254,600011286,600011297,600011329,600011361,600011169,600011201,600011233,600011308,600011340,600011180,600011212,600011244,600011276,600011319,600011351,600011191,600011223,600011255,600011287,600011298,600011330,600011362,600011170,600011202,600011234,600011266,600011309,600011341,600011181,600011213,600011245,600011277,600011320,600011352,600011160,600011192,600011224,600011256,600011288,600011299,600011331,600011363,600011171,600011203,600011235,600011267,600011310,600011342,600011182,600011214,600011246,600011278,600011321,600011353,600011161,600011193,600011225,600011257,600011289,600011300,600011332,600011364,600011172,600011204,600011236,600011268,600011311,600011343,600011183,600011247,600011279,600011322,600011354,600011162,600011194,600011226,600011258,600011290,600011301,600011333,600011173,600011205,600011237,600011269,600011312,600011344,600011184,600011216,600011248,600011280,600011323,600011355,600011163,600011195,600011227,600011259,600011291,600011302,600011334,600011174,600011206,600011238,600011270,600011313,600011345,600011185,600011217,600011249,600011281,600011150,600011154,600011151,600011152,600011153,600011159,600011157,600011155,600011113,600011156,600011158,600011165,600011315,600011265,600011215,600011365,501599325,2464051,245389735,433255115,331287294,341887614,627404704,496949359,482219275,223710000,573762826,228072370,487790361,373410430,513292950,563094213,556578944,416512586,579586214]

    def __init__(self, parent):
        super(UserBehavior, self).__init__(parent)
        totallen = len(self.testAccountIds)
        accountId = self.testAccountIds[randint(0, totallen - 1)]
        headerStr = json.dumps({"id": accountId, "uuid": "mockuuid13fw3342fw"}).encode('utf-8')
        header = base64.b64encode(headerStr)
        base64_message = header.decode('utf-8')

        self.headers = {
            'X-Shopback-Domain': 'www.shopback.sg',
            'X-Shopback-Agent': 'sbiosagent/1.0',
            'X-Shopback-Key': 'q452R0g0muV3OXP8VoE7q3wshmm2rdI3',
            'X-Shopback-Client-User-Agent': 'Locust test',
            'Authorization': 'JWT ' + base64_message
        }
        
    @task(3)
    def getOfferById(self):
        offerId = randint(14552, 20158)
        self.client.get(url="/v2/offers/" + str(offerId) + "?excludeRecommend=true",
            headers=self.headers)
        self.client.close()

class WebsiteUser(HttpUser):
    tasks = [UserBehavior]
    wait_time = between(0.1, 0.2)
